C51 COMPILER V9.57.0.0   ONEWIRE                                                           02/26/2020 12:52:35 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\onewire.obj
COMPILER INVOKED BY: E:\keil~5\C51\BIN\C51.EXE onewire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\on
                    -ewire.lst) TABS(2) OBJECT(.\Objects\onewire.obj)

line level    source

   1          #include "onewire.h"
   2          #include <STC15F2K60S2.h>
   3          unsigned char THEROM[8];
   4          sbit DQ = P1^4;
   5          
   6          void Delay1us()   //@11.0592MHz
   7          {
   8   1        _nop_();
   9   1        _nop_();
  10   1        _nop_();
  11   1      }
  12          
  13          
  14          void Delay60us()    //@11.0592MHz
  15          {
  16   1        unsigned char i, j;
  17   1      
  18   1        i = 1;
  19   1        j = 162;
  20   1        do
  21   1        {
  22   2          while (--j);
  23   2        } while (--i);
  24   1      }
  25          
  26          
  27          void Delay500us()   //@11.0592MHz
  28          {
  29   1        unsigned char i, j;
  30   1      
  31   1        _nop_();
  32   1        _nop_();
  33   1        i = 6;
  34   1        j = 93;
  35   1        do
  36   1        {
  37   2          while (--j);
  38   2        } while (--i);
  39   1      }
  40          
  41          void InitDS18B20()
  42          {
  43   1        DQ = 1;
  44   1        DQ = 0;
  45   1        Delay500us();
  46   1        DQ = 1;
  47   1        Delay500us();
  48   1      }
  49          
  50          void write_ds(unsigned char dat)
  51          {
  52   1        unsigned char i;
  53   1        for (i=0; i<8; i++)
  54   1        {
C51 COMPILER V9.57.0.0   ONEWIRE                                                           02/26/2020 12:52:35 PAGE 2   

  55   2          DQ = 0;
  56   2          Delay1us();
  57   2          DQ = dat&0x01;    
  58   2          Delay60us();
  59   2          DQ = 1;   
  60   2          dat >>= 1;
  61   2        }
  62   1      }
  63          
  64          unsigned char read_ds()
  65          {
  66   1        unsigned char i,temp;
  67   1        for (i=0; i<8; i++)
  68   1        {
  69   2          DQ = 0;
  70   2          temp >>= 1;
  71   2          DQ = 1;
  72   2          Delay1us();
  73   2          if (DQ)
  74   2          {
  75   3            temp |= 0x80;
  76   3          }
  77   2          Delay60us();
  78   2        }
  79   1        return temp;
  80   1      }
  81          
  82          unsigned char read_T()
  83          {
  84   1        unsigned char i;
  85   1        unsigned char high, low, temper;
  86   1        InitDS18B20();
  87   1        write_ds(0x55);
  88   1        for (i=0; i<8; i++)
  89   1        {
  90   2          write_ds(THEROM[i]);
  91   2        }
  92   1        write_ds(0x44);
  93   1        
  94   1        InitDS18B20();
  95   1        write_ds(0x55);
  96   1        for (i=0; i<8; i++)
  97   1        {
  98   2          write_ds(THEROM[i]);
  99   2        }
 100   1        write_ds(0xBE);
 101   1        low = read_ds();
 102   1        high = read_ds();
 103   1        
 104   1        temper = low>>4;
 105   1        temper |= high<<4;
 106   1        
 107   1        return temper;
 108   1      }
 109          
 110          void ReadROM()
 111          {
 112   1        unsigned char i;
 113   1        InitDS18B20();
 114   1        write_ds(0x33);
 115   1        for (i=0; i<8; i++)
 116   1        {
C51 COMPILER V9.57.0.0   ONEWIRE                                                           02/26/2020 12:52:35 PAGE 3   

 117   2          THEROM[i] = read_ds();
 118   2        }
 119   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    188    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
