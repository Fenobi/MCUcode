C51 COMPILER V9.59.0.0   LCD1602                                                           12/18/2022 18:16:23 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\Objects\LCD1602.obj
COMPILER INVOKED BY: D:\MDK5\C51\BIN\C51.EXE LCD1602.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\LCD1
                    -602.lst) TABS(2) OBJECT(.\Objects\LCD1602.obj)

line level    source

   1          #include "lcd1602.h"
   2          #include <stdio.h>
   3          
   4          /*******************************************************************************
   5          * 函 数 名         : Lcd1602_Delay1ms
   6          * 函数功能       : 延时函数，延时1ms
   7          * 输    入         : c
   8          * 输    出         : 无
   9          * 说    名         : 该函数是在12MHZ晶振下，12分频单片机的延时。
  10          *******************************************************************************/
  11          void Lcd1602_Delay1ms(uint c)   //误差 0us
  12          {
  13   1        uchar a,b;
  14   1        for (; c>0; c--)
  15   1        {
  16   2           for (b=199;b>0;b--)
  17   2           {
  18   3              for(a=1;a>0;a--);
  19   3           }      
  20   2        }     
  21   1      }
  22          
  23          /*******************************************************************************
  24          * 函 数 名         : LcdWriteCom
  25          * 函数功能       : 向LCD写入一个字节的命令
  26          * 输    入         : com
  27          * 输    出         : 无
  28          *******************************************************************************/
  29          void LcdWriteCom(uchar com)   //写入命令
  30          {
  31   1        LCD1602_E = 0;     //使能
  32   1        LCD1602_RS = 0;    //选择发送命令
  33   1        LCD1602_RW = 0;    //选择写入
  34   1        
  35   1        LCD1602_DATAPINS = com;     //放入命令
  36   1        Lcd1602_Delay1ms(1);    //等待数据稳定
  37   1      
  38   1        LCD1602_E = 1;            //写入时序
  39   1        Lcd1602_Delay1ms(5);    //保持时间
  40   1        LCD1602_E = 0;
  41   1      }
  42          /*******************************************************************************
  43          * 函 数 名         : LcdWriteData
  44          * 函数功能       : 向LCD写入一个字节的数据
  45          * 输    入         : dat
  46          * 输    出         : 无
  47          *******************************************************************************/          
  48          void LcdWriteData(uchar dat)      //写入数据
  49          {
  50   1        LCD1602_E = 0;  //使能清零
  51   1        LCD1602_RS = 1; //选择输入数据
  52   1        LCD1602_RW = 0; //选择写入
  53   1      
  54   1        LCD1602_DATAPINS = dat; //写入数据
C51 COMPILER V9.59.0.0   LCD1602                                                           12/18/2022 18:16:23 PAGE 2   

  55   1        Lcd1602_Delay1ms(1);
  56   1      
  57   1        LCD1602_E = 1;   //写入时序
  58   1        Lcd1602_Delay1ms(5);   //保持时间
  59   1        LCD1602_E = 0;
  60   1      }
  61          
  62          /*******************************************************************************
  63          * 函 数 名       : LcdInit()
  64          * 函数功能     : 初始化LCD屏
  65          * 输    入       : 无
  66          * 输    出       : 无
  67          *******************************************************************************/       
  68          void LcdInit()              //LCD初始化子程序
  69          {
  70   1        LcdWriteCom(0x38);  //开显示
  71   1        LcdWriteCom(0x0c);  //开显示不显示光标
  72   1        LcdWriteCom(0x06);  //写一个指针加1
  73   1        LcdWriteCom(0x01);  //清屏
  74   1        LcdWriteCom(0x80);  //设置数据指针起点
  75   1      }
  76          /**************************************
  77          功能描述：LCD1602按指定位置显示一个字符
  78          入口参数：uint8 X, uint8 Y, uint8 DData
  79          返回值：无
  80          ***************************************/
  81          void DisplayOneChar(uchar X, uchar Y, uchar DData)
  82          {
  83   1        Y &= 0x1;
  84   1        X &= 0xF; //限制X不能大于15，Y不能大于1
  85   1        if (Y) X |= 0x40; //当要显示第二行时地址码+0x40;
  86   1        X |= 0x80; //算出指令码
  87   1        LcdWriteCom(X); //发命令字
  88   1        LcdWriteData(DData); //发数据
  89   1      }
  90          
  91          /**************************************
  92          功能描述：LCD1602按指定位置显示一串字符
  93          入口参数：uint8 X, uint8 Y, uint8 DData  X代表第X+1列，Y代表第Y+1行
  94          返回值：无
  95          ***************************************/
  96          void DisplayListChar(uchar X, uchar Y, uchar *DData)
  97          {
  98   1        uchar ListLength;
  99   1      
 100   1        ListLength = 0;
 101   1        Y &= 0x1;
 102   1        X &= 0xF; //限制X不能大于15，Y不能大于1
 103   1        while (DData[ListLength]>0x19) //若到达字串尾则退出
 104   1          {
 105   2            if (X <= 0xF)        //X坐标应小于0xF
 106   2              {
 107   3                DisplayOneChar(X, Y, DData[ListLength]); //显示单个字符
 108   3                ListLength++;
 109   3                X++;
 110   3              }
 111   2          }
 112   1      }
 113          
 114          uchar txt[20];
 115          //例如：Display_XS(5, 0,23.674,2);  LCD1602液晶显示屏第0行第5个考试显示数值23.67 因为后面是2，所有只显示小
             -数点后2位
C51 COMPILER V9.59.0.0   LCD1602                                                           12/18/2022 18:16:23 PAGE 3   

 116          void Display_XS(uchar X, uchar Y,float XS,uchar XS_wei)//显示指定小数。
 117          {
 118   1        switch(XS_wei)
 119   1        {
 120   2          case 0: sprintf(txt,"%0.0f",XS); break;
 121   2          case 1: sprintf(txt,"%0.1f",XS); break;
 122   2          case 2: sprintf(txt,"%0.2f",XS); break;
 123   2          case 3: sprintf(txt,"%0.3f",XS); break;
 124   2        }
 125   1        DisplayListChar(X, Y,txt);//显示小数变量数值****4 
 126   1      }
 127          
 128          uint lcd_1602=9845;
 129          float XS=23.48;
 130          uchar code Disp1[]={"0123456789"};
 131          
 132          void LCD1602_test(void)//LCD1602测试程序
 133          {
 134   1        LcdInit(); //LCD1602初始化
 135   1        
 136   1        while(1)
 137   1        {
 138   2          DisplayListChar(0, 0, "WMH");     //从第一行第0列开始显示内容****1
 139   2          DisplayListChar(6, 0, Disp1);  //显示字符数组内容****2
 140   2          
 141   2          lcd_1602=41;  
 142   2          sprintf(txt,"num:%d",lcd_1602);
 143   2          DisplayListChar(0,1,txt);//显示整数变量数值****3
 144   2          
 145   2          Display_XS(8, 1,24.632,2);//显示指定小数****4
 146   2        }
 147   1      }
 148          
 149          ////    LcdWriteCom(0x01);//清屏
 150          
 151          
 152          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    395    ----
   CONSTANT SIZE    =     46    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     26      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
