C51 COMPILER V9.59.0.0   DS18B20                                                           12/18/2022 18:05:18 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\Objects\DS18B20.obj
COMPILER INVOKED BY: D:\MDK5\C51\BIN\C51.EXE DS18B20.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\DS18
                    -B20.lst) TABS(2) OBJECT(.\Objects\DS18B20.obj)

line level    source

   1          #include "DS18B20.h"
   2          #include "delay.h"
   3          
   4          /**********DS18B20参数*************
   5          *测温范围：-55―+125°在-10―+85度，精度为0.5度
   6          *分辨率：9―12位，分变度0.5，0.25，0.125，0.0625。
   7          *
   8          ************************/
   9          
  10          char DS18B20_Reset()//DS18B20复位
  11          {
  12   1          char flag;
  13   1          DS18B20_DQ=0;
  14   1          delay_1us(250);//延时480-960us
  15   1          DS18B20_DQ=1;
  16   1          delay_1us(25);//延时15-60us
  17   1          flag=DS18B20_DQ;
  18   1          delay_1us(200);//延时400us
  19   1          return flag;
  20   1      }
  21          
  22          
  23          void DS18B20_WriteData(unsigned char dat)//向DS18B20写数据
  24          {
  25   1          unsigned char i;
  26   1          for(i=0;i<8;i++)
  27   1          {
  28   2              DS18B20_DQ=0;
  29   2              delay_1us(4);//延时4us
  30   2              DS18B20_DQ=dat&0x01;//取最低位
  31   2              delay_1us(25);//延时60us
  32   2              DS18B20_DQ=1;//释放总线
  33   2              dat=dat>>1;
  34   2          }
  35   1      }
  36          
  37          unsigned char DS18B20_ReadData()//向DS18B20读数据
  38          {
  39   1          unsigned char i,dat;
  40   1          for(i=0;i<8;i++)
  41   1          {
  42   2              dat>>=1;
  43   2              DS18B20_DQ=0;
  44   2              delay_1us(4);//延时4us
  45   2              DS18B20_DQ=1;
  46   2              delay_1us(6);//延时6us
  47   2              if(DS18B20_DQ==1)
  48   2              {
  49   3                  dat=dat|0x80;
  50   3              }
  51   2              delay_1us(50);//延时60us       
  52   2              DS18B20_DQ=1;//释放总线
  53   2          }
  54   1          return dat;
C51 COMPILER V9.59.0.0   DS18B20                                                           12/18/2022 18:05:18 PAGE 2   

  55   1      }
  56          
  57          
  58          float DS18B20_Tem()//DS18B20返回温度值函数
  59          {
  60   1          unsigned int DataH;
  61   1          unsigned char DataL;
  62   1          float Temp;
  63   1      
  64   1          DS18B20_Reset();//DS18B20复位
  65   1          DS18B20_WriteData(0xcc);//向DS18B20写数据(跳过ROM温度检测)
  66   1          DS18B20_WriteData(0x44);//向DS18B20写数据(启动温度转换)
  67   1          
  68   1          DS18B20_Reset();//DS18B20复位
  69   1          DS18B20_WriteData(0xcc);//向DS18B20写数据(跳过ROM温度检测)
  70   1          DS18B20_WriteData(0xBE);//向DS18B20写数据(读暂存器命令)
  71   1          DataL=DS18B20_ReadData();//向DS18B20读数据(读低八位)
  72   1          DataH=DS18B20_ReadData();//向DS18B20读数据(读高八位)
  73   1          DataH=(DataH<<8) | DataL;//组合
  74   1          if((DataH & 0xF800) == 0xF800)//温度为负温度,则取反然后加1
  75   1          {
  76   2              DataH = ~DataH+1;
  77   2          }
  78   1          Temp=DataH * 0.0625;
  79   1          return Temp;
  80   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    222    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
