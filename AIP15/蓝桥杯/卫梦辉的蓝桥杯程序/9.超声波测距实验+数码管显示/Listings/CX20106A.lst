C51 COMPILER V9.59.0.0   CX20106A                                                          12/18/2022 22:10:24 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE CX20106A
OBJECT MODULE PLACED IN .\Objects\CX20106A.obj
COMPILER INVOKED BY: D:\MDK5\C51\BIN\C51.EXE CX20106A.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\CX2
                    -0106A.lst) TABS(2) OBJECT(.\Objects\CX20106A.obj)

line level    source

   1          #include "CX20106A.h"//超声波函数头文件
   2          
   3          //切记，计算距离不使用分频
   4          sbit TX = P1^0;  //发射引脚
   5          sbit RX = P1^1;  //接收引脚
   6          
   7          //12us
   8          void Delay12us(void)//@11.0592MHz
   9          {
  10   1        unsigned char i;
  11   1        _nop_();
  12   1        _nop_();
  13   1        _nop_();
  14   1        i = 30;
  15   1        while (--i);
  16   1      }
  17          
  18          void send_wave(void)//发送八段脉冲波(40Khz)
  19          {
  20   1        unsigned char i = 8;
  21   1        while(i --)
  22   1        {
  23   2          TX = 1;
  24   2          Delay12us();
  25   2          TX = 0;
  26   2          Delay12us();
  27   2        }
  28   1      }
  29          
  30          void CSB_Init(void)//超声波定时器初始化
  31          {
  32   1        AUXR |= 0x80;
  33   1        TMOD |= 0x10;  //配置定时器工作模式 
  34   1        TH1 = 0;
  35   1        TL1 = 0;  
  36   1      //  EA = 1; 
  37   1      }
  38          
  39          //超声波模块获得距离函数（函数还回距离值 单位：cm）
  40          u16 Get_Distance(void) //@11.0592MHz
  41          {
  42   1        u16 distance,time;
  43   1        send_wave();  //发送方波信号
  44   1        TR1 = 1;  //启动计时
  45   1        while((RX == 1) && (TF1 == 0));  //等待收到脉冲，没有计满溢出
  46   1        TR1 = 0;  //关闭计时
  47   1      
  48   1        //发生溢出
  49   1        if(TF1 == 1)
  50   1        {
  51   2          TF1 = 0;
  52   2          distance = 100;  //无返回
  53   2        }
  54   1        else
C51 COMPILER V9.59.0.0   CX20106A                                                          12/18/2022 22:10:24 PAGE 2   

  55   1        {
  56   2          /**  计算时间  */
  57   2          time=TH1*256+TL1;
  58   2          distance = (unsigned int)(time*0.017);  //计算距离取整数（单位CM）        
  59   2        }
  60   1        TH1 = 0;
  61   1        TL1 = 0;
  62   1            
  63   1        return distance;           
  64   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    114    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
