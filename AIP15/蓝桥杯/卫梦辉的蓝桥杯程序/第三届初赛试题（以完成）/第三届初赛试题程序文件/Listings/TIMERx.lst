C51 COMPILER V9.60.0.0   TIMERX                                                            03/10/2023 20:31:51 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMERX
OBJECT MODULE PLACED IN .\Objects\TIMERx.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE TIMERx.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\TI
                    -MERx.lst) OBJECT(.\Objects\TIMERx.obj)

line level    source

   1          #include "TIMERx.h"//定时器函数头文件
   2          #define FOSC 11059200L
   3          
   4          #define T1MS (65536-FOSC/1000)      //1T模式***定时1000us（1ms）1
   5          //#define T1MS (65536-FOSC/12/1000) //12T模式**定时1000us（1ms）2
   6          
   7          //**************************************************************
   8          void TIM0_Init(void)//定时器0初始化函数
   9          {
  10   1          AUXR |= 0x80;                   //定时器0为1T模式 1
  11   1      //  AUXR &= 0x7f;                   //定时器0为12T模式 2
  12   1      
  13   1          TMOD = 0x00;                    //设置定时器为模式0(16位自动重装载)
  14   1              
  15   1          TL0 = T1MS*5;                     //初始化计时值(5ms)
  16   1          TH0 = T1MS*5 >> 8;
  17   1          TR0 = 0;                        //使能定时器0中断
  18   1          EA = 1;                                                    //定时器0开始计时
  19   1          ET0 = 1;                                                            //打开总中断
  20   1      }
  21          
  22          u16 TIM0_count;
  23          float Water_L=0;
  24          void timer0_isr() interrupt 1
  25          {
  26   1              TIM0_count++;
  27   1              if(TIM0_count>200)//时间：5ms*200=1s
  28   1              {
  29   2                      TIM0_count=0;
  30   2                      Water_L=Water_L+0.100;
  31   2              }
  32   1      }
  33          
  34          
  35          //**************************************************************
  36          void TIM1_Init(void)//定时器1初始化函数
  37          {
  38   1          AUXR |= 0x40;                   //定时器1为1T模式 1
  39   1      //  AUXR &= 0xdf;                   //定时器1为12T模式 2
  40   1      
  41   1          TMOD = 0x00;                    //设置定时器为模式0(16位自动重装载)
  42   1          TL1 = T1MS*5;                     //初始化计时值(5ms)
  43   1          TH1 = T1MS*5 >> 8;
  44   1          TR1 = 1;                        //定时器1开始计时
  45   1          ET1 = 1;                        //使能定时器0中断
  46   1          EA = 1;                                                                                                     //打开总中断
  47   1      }
  48          
  49          u16 TIM1_count;
  50          void timer1_isr() interrupt 3
  51          {
  52   1              TIM1_count++;
  53   1              if(TIM1_count>100)//时间：5ms*100=500ms
  54   1              {
C51 COMPILER V9.60.0.0   TIMERX                                                            03/10/2023 20:31:51 PAGE 2   

  55   2                      TIM1_count=0;
  56   2                      P01=~P01;
  57   2              }       
  58   1      }
  59          
  60          //**************************************************************
  61          void TIM2_Init(void)//定时器2初始化函数
  62          {
  63   1          AUXR |= 0x04;                   //定时器2为1T模式 1
  64   1      //  AUXR &= ~0x04;                  //定时器2为12T模式 2
  65   1              
  66   1          T2L = T1MS;                     //初始化计时值
  67   1          T2H = T1MS >> 8;
  68   1          AUXR |= 0x10;                   //定时器2开始计时
  69   1          
  70   1          IE2 |= 0x04;                    //开定时器2中断
  71   1          EA = 1;
  72   1      }
  73          
  74          //中断服务程序
  75          u16 TIM2_count;
  76          void timer2_isr() interrupt 12           //中断入口
  77          {
  78   1              TIM2_count++;
  79   1              if(TIM2_count>50)//时间：5ms*50=250ms
  80   1              {
  81   2                      TIM2_count=0;
  82   2                      P02=~P02;
  83   2              }       
  84   1              
  85   1      //  IE2 &= ~0x04;                   //若需要手动清除中断标志,可先关闭中断,此时系统会自动清除内部的中断标志
  86   1      //  IE2 |= 0x04;                    //然后再开中断即可
  87   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    230    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
