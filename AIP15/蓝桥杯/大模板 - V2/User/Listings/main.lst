C51 COMPILER V9.60.0.0   MAIN                                                              04/05/2023 09:20:23 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Driver) DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          /* å¤´æ–‡ä»¶å£°æ˜åŒº */
   2          #include <STC15F2K60S2.H>//å•ç‰‡æœºå¯„å­˜å™¨ä¸“ç”¨å¤´æ–‡ä»¶
   3          #include <Init.h>//åˆå§‹åŒ–åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   4          #include <Led.h>//Ledåº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   5          #include <Key.h>//æŒ‰é”®åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   6          #include <Seg.h>//æ•°ç ç®¡åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   7          #include <Uart.h>//ä¸²å£åº•å±‚é©±åŠ¨ä¸“ç”¨å¤´æ–‡ä»¶
   8          
   9          /* å˜é‡å£°æ˜åŒº */
  10          unsigned char Key_Val,Key_Down,Key_Old,Key_Up;//æŒ‰é”®ä¸“ç”¨å˜é‡
  11          unsigned char Key_Slow_Down;//æŒ‰é”®å‡é€Ÿä¸“ç”¨å˜é‡
  12          unsigned char Seg_Buf[8] = {10,10,10,10,10,10,10,10};//æ•°ç ç®¡æ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  13          unsigned char Seg_Point[8] = {0,0,0,0,0,0,0,0};//æ•°ç ç®¡å°æ•°ç‚¹æ•°æ®å­˜æ”¾æ•°ç»„
  14          unsigned char Seg_Pos;//æ•°ç ç®¡æ‰«æä¸“ç”¨å˜é‡
  15          unsigned int Seg_Slow_Down;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨å˜é‡
  16          unsigned char ucLed[8] = {0,0,0,0,0,0,0,0};//Ledæ˜¾ç¤ºæ•°æ®å­˜æ”¾æ•°ç»„
  17          unsigned char Uart_Slow_Down;//ä¸²å£å‡é€Ÿä¸“ç”¨å˜é‡
  18          unsigned char Uart_Recv[10];//ä¸²å£æ¥æ”¶æ•°æ®å‚¨å­˜æ•°ç»„ é»˜è®¤10ä¸ªå­—èŠ‚ è‹¥æ¥æ”¶æ•°æ®è¾ƒé•¿ å¯æ›
             -´æ”¹æœ€å¤§å­—èŠ‚æ•°
  19          unsigned char Uart_Recv_Index;//ä¸²å£æ¥æ”¶æ•°ç»„æŒ‡é’ˆ
  20          unsigned char Uart_Send[10];//ä¸²å£æ¥æ”¶æ•°æ®å‚¨å­˜æ•°ç»„ é»˜è®¤10ä¸ªå­—èŠ‚ è‹¥å‘é€æ•°æ®è¾ƒé•¿ å¯æ›
             -´æ”¹æœ€å¤§å­—èŠ‚æ•°
  21          
  22          /* é”®ç›˜å¤„ç†å‡½æ•° */
  23          void Key_Proc()
  24          {
  25   1              if(Key_Slow_Down) return;
  26   1              Key_Slow_Down = 1;//é”®ç›˜å‡é€Ÿç¨‹åº
  27   1      
  28   1              Key_Val = Key_Read();//å®æ—¶è¯»å–é”®ç å€¼
  29   1              Key_Down = Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸‹é™æ²¿
  30   1              Key_Up = ~Key_Val & (Key_Old ^ Key_Val);//æ•æ‰æŒ‰é”®ä¸Šé™æ²¿
  31   1              Key_Old = Key_Val;//è¾…åŠ©æ‰«æå˜é‡
  32   1      
  33   1      }
  34          
  35          /* ä¿¡æ¯å¤„ç†å‡½æ•° */
  36          void Seg_Proc()
  37          {
  38   1              if(Seg_Slow_Down) return;
  39   1              Seg_Slow_Down = 1;//æ•°ç ç®¡å‡é€Ÿç¨‹åº
  40   1      
  41   1      }
  42          
  43          /* å…¶ä»–æ˜¾ç¤ºå‡½æ•° */
  44          void Led_Proc()
  45          {
  46   1              
  47   1      }
  48          
  49          /* ä¸²å£å¤„ç†å‡½æ•° */
  50          void Uart_Proc()
  51          {
  52   1              if(Uart_Slow_Down) return;
C51 COMPILER V9.60.0.0   MAIN                                                              04/05/2023 09:20:23 PAGE 2   

  53   1              Uart_Slow_Down = 1;//ä¸²å£å‡é€Ÿç¨‹åº 
  54   1              
  55   1      }
  56          
  57          /* å®šæ—¶å™¨0ä¸­æ–­åˆå§‹åŒ–å‡½æ•° */
  58          void Timer0Init(void)           //1æ¯«ç§’@12.000MHz
  59          {
  60   1              AUXR &= 0x7F;           //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
  61   1              TMOD &= 0xF0;           //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
  62   1              TL0 = 0x18;             //è®¾ç½®å®šæ—¶åˆå§‹å€¼
  63   1              TH0 = 0xFC;             //è®¾ç½®å®šæ—¶åˆå§‹å€¼
  64   1              TF0 = 0;                //æ¸…é™¤TF0æ ‡å¿—
  65   1              TR0 = 1;                //å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
  66   1              ET0 = 1;    //å®šæ—¶å™¨ä¸­æ–­0æ‰“å¼€
  67   1              EA = 1;     //æ€»ä¸­æ–­æ‰“å¼€
  68   1      }
  69          
  70          /* å®šæ—¶å™¨0ä¸­æ–­æœåŠ¡å‡½æ•° */
  71          void Timer0Server() interrupt 1
  72          {  
  73   1              if(++Key_Slow_Down == 10) Key_Slow_Down = 0;//é”®ç›˜å‡é€Ÿä¸“ç”¨
  74   1              if(++Seg_Slow_Down == 500) Seg_Slow_Down = 0;//æ•°ç ç®¡å‡é€Ÿä¸“ç”¨
  75   1              if(++Uart_Slow_Down == 200) Uart_Slow_Down = 0;//ä¸²å£å‡é€Ÿä¸“ç”¨
  76   1              if(++Seg_Pos == 8) Seg_Pos = 0;//æ•°ç ç®¡æ˜¾ç¤ºä¸“ç”¨
  77   1              Seg_Disp(Seg_Pos,Seg_Buf[Seg_Pos],Seg_Point[Seg_Pos]);
  78   1              Led_Disp(Seg_Pos,ucLed[Seg_Pos]);
  79   1      }
  80          
  81          /* ä¸²å£1ä¸­æ–­æœåŠ¡å‡½æ•° */
  82          void Uart1Server() interrupt 4
  83          {
  84   1              if(RI == 1) //ä¸²å£æ¥æ”¶æ•°æ®
  85   1              {
  86   2                      Uart_Recv[Uart_Recv_Index] = SBUF;
  87   2                      Uart_Recv_Index++;
  88   2                      RI = 0;
  89   2              }
  90   1      }
  91          
  92          /* Main */
  93          void main()
  94          {
  95   1              System_Init();
  96   1              Timer0Init();
  97   1              UartInit();
  98   1              while (1)
  99   1              {
 100   2                      Key_Proc();
 101   2                      Seg_Proc();
 102   2                      Led_Proc();
 103   2                      Uart_Proc();
 104   2              }
 105   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    272    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     54    ----
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   MAIN                                                              04/05/2023 09:20:23 PAGE 3   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
